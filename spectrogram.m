

%[wavin0,fs]=audioread('/Users/yijuwang/Desktop/spto/test.wav');               % ????????????
% nwind=240; noverlap=160; inc=nwind-noverlap;   % ??????????240????????160????????80
% w_nwind=hanning(200); w_noverlap=195;          % ??????????200??????????195
% nfft=200;                                      % FFT??????200
% % ????????pwelch_2??????????????????
% [Pxx] = pwelch_2(wavin0, nwind, noverlap, w_nwind, w_noverlap, nfft);
% frameNum=size(Pxx,2);                          % ????????
% frameTime=frame2time(frameNum,nfft,inc,fs);    % ??????????????????
% freq=(0:nfft/2)*fs/nfft;                       % ????????????
% % ????
% imagesc(frameTime,freq,Pxx); axis xy           
% ylabel('????/Hz');
% xlabel('????/s');
% title('??????????????????')
% m = 256; LightYellow = [0.6 0.6 0.6];
% MidRed = [0 0 0]; Black = [0.5 0.7 1];
% Colors = [LightYellow; MidRed; Black];
% colormap(SpecColorMap(m,Colors));
% 
% function [Pxx] = pwelch_2(x, nwind, noverlap, w_nwind, w_noverlap, nfft)
% % ??????????????????????
% % x????????nwind????????????noverlap??????????????????
% % w_nwind??????????????????????????????
% % w_noverlap??????????????????????????nfft??FFT??????
% 
% x=x(:);
% inc=nwind-noverlap;       % ????????
% X=enframe(x,nwind,inc)';  % ????
% frameNum=size(X,2);       % ????????
% %??pwelch????????????????????????????
% for k=1 : frameNum
%     Pxx(:,k)=pwelch(X(:,k),w_nwind,w_noverlap,nfft);
% end
% end

for i=1:7
    
filename = sprintf('%s_%d.%s','/Users/yijuwang/Desktop/spto/yw/segment/seg', i, 'wav');
[x, Fs]=audioread(filename);
%[x,Fs]=audioread('/Users/yijuwang/Desktop/spto/yw/ywt.wav'); 
%[x,Fs]=audioread('/Users/yijuwang/Desktop/spto/song2.wav', [1,Fs*0.1+1]); 
x=x(:,1); % one channel
%x=x-mean(x);				% zero-mean substraction

%x=x(22232:Fs*0.8+22232);% ????????????

%x=x(1:Fs*5+1);
% modulation = cos(3000/24000*pi*length(x));
% h = (5000/24000)*sinc((5000/24000)*length(x));
% h2 = 2*x.*modulation;


%h = (5000/24000)*sinc((5000/24000)*length(x));
%x = conv(h,x);

%x=x(Fs*0.2+1:Fs*0.8+1);
%x=downsample(x,2);
%x1=x;
%Fs=Fs/2;
wlen=256; inc=128; win=hanning(wlen);% ??????????????????????
N=length(x); time=(0:N-1)/Fs;       % ????????
y=enframe(x,win,inc)';              % ????
fn=size(y,2);                       % ????
frameTime=(((1:fn)-1)*inc+wlen/2)/Fs; % ??????????????????
W2=wlen/2+1; n2=1:W2;
freq=(n2-1)*Fs/wlen;                % ????FFT????????????
Y=fft(y);                           % ??????????????
%=====================================================
%prominent region
% for i=1:size(Y,2)
%     peak=find(abs(Y(n2,i))==max(abs(Y(n2,i))));
%     for j=n2
% %         if (peak==1 || peak==length(n2))
% %             if (peak==1)
% %                 if(j~=peak && j~=peak+1)
% %                     Y(j,i)=0;
% %                 end
% %             else
% %                 if(j~=peak && j~=peak-1)
% %                     Y(j,i)=0;
% %                 end
% %             end
% %         elseif (j~=peak && j~=peak+1 && j~=peak-1)
%         if (j~=peak && j~=peak+1 && j~=peak-1 && j~=peak+2 && j~=peak-2 && j~=peak+3 && j~=peak-3 && j~=peak+4 && j~=peak-4 && j~=peak+5 && j~=peak-5 && j~=peak+6 && j~=peak-6 && j~=peak+7 && j~=peak-7 && j~=peak+8 && j~=peak-8 && j~=peak+9 && j~=peak-9 && j~=peak+10 && j~=peak-10 && j~=peak+11 && j~=peak-11 && j~=peak+12 && j~=peak-12 && j~=peak+13 && j~=peak-13 && j~=peak+14 && j~=peak-14)
%                 Y(j,i)=0;
%         end       
%     end
% end
yt=Y;
clf                                 % ??????????
%=====================================================%
% Plot the STFT result              % ??????????        
%=====================================================%

set(gcf,'Position',[20 100 600 500]);            
axes('Position',[0.1 0.1 0.85 0.5]);  
imagesc(frameTime,freq,abs(Y(n2,:))); % ????Y??????  
axis xy; ylabel('????/Hz');xlabel('????/s');
title('??????');
m = 64;
LightYellow = [0.6 0.6 0.6];
MidRed = [0 0 0];
Black = [0.5 0.7 1];
Colors = [LightYellow; MidRed; Black];
colormap(SpecColorMap(m,Colors));

%=====================================================%
% Plot the Speech Waveform          % ??????????????????  
%=====================================================%
figure()
axes('Position',[0.07 0.72 0.9 0.22]);
plot(time,x,'k');
xlim([0 max(time)]);
xlabel('Time/s'); ylabel('Frequency');
title('spectrogram');
hold on
end